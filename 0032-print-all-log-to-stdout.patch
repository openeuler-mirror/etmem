From 3412ce69e8b61ad6d38f3d792930e8f2bafe6f00 Mon Sep 17 00:00:00 2001
From: Kemeng Shi <shikemeng@huawei.com>
Date: Wed, 12 May 2021 19:50:43 +0800
Subject: [PATCH 32/50] print all log to stdout

Signed-off-by: Kemeng Shi <shikemeng@huawei.com>
---
 src/etmem_src/etmem.c         | 2 +-
 src/etmem_src/etmem_project.c | 2 +-
 src/etmem_src/etmem_rpc.c     | 7 ++++---
 3 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/src/etmem_src/etmem.c b/src/etmem_src/etmem.c
index 7f04ad1..aadde74 100644
--- a/src/etmem_src/etmem.c
+++ b/src/etmem_src/etmem.c
@@ -29,7 +29,7 @@ SLIST_HEAD(etmem_obj_list, etmem_obj) g_etmem_objs;
 
 static void usage(void)
 {
-    fprintf(stderr,
+    fprintf(stdout,
             "\nUsage:\n"
             "    etmem OBJECT COMMAND\n"
             "    etmem help\n"
diff --git a/src/etmem_src/etmem_project.c b/src/etmem_src/etmem_project.c
index ef2d8fe..2caaff5 100644
--- a/src/etmem_src/etmem_project.c
+++ b/src/etmem_src/etmem_project.c
@@ -25,7 +25,7 @@
 
 static void project_help(void)
 {
-    fprintf(stderr,
+    fprintf(stdout,
             "\nUsage:\n"
             "    etmem project start [options]\n"
             "    etmem project stop [options]\n"
diff --git a/src/etmem_src/etmem_rpc.c b/src/etmem_src/etmem_rpc.c
index 2c70cf8..76a8cf4 100644
--- a/src/etmem_src/etmem_rpc.c
+++ b/src/etmem_src/etmem_rpc.c
@@ -21,6 +21,7 @@
 #include <sys/time.h>
 #include <sys/un.h>
 #include <errno.h>
+#include <string.h>
 #include "securec.h"
 #include "etmem_rpc.h"
 
@@ -71,7 +72,7 @@ static int etmem_client_conn(const struct mem_proj *proj, int sockfd)
 
     if (connect(sockfd, (struct sockaddr *)&svr_addr,
                 offsetof(struct sockaddr_un, sun_path) + strlen(proj->sock_name) + 1) < 0) {
-        perror("etmem connect to server failed:");
+        printf("etmem connect to server failed: %s\n", strerror(errno));
         return errno;
     }
 
@@ -137,7 +138,7 @@ static int etmem_client_send(const struct mem_proj *proj, int sockfd)
     }
 
     if (send(sockfd, reg_cmd, reg_cmd_len, 0) < 0) {
-        perror("send failed:");
+        printf("send failed: %s\n", strerror(errno));
         goto EXIT;
     }
     ret = 0;
@@ -165,7 +166,7 @@ static int etmem_client_recv(int sockfd)
     while (!done) {
         recv_size = recv(sockfd, recv_buf, recv_len - 1, 0);
         if (recv_size < 0) {
-            perror("recv failed:");
+            printf("recv failed: %s\n", strerror(errno));
             goto EXIT;
         }
         if (recv_size == 0) {
-- 
2.27.0

